define("tool_pluginskel/addmore",["jquery"],(function($){var addElements={deleteElements:function(templateVars,variableNames,isComponentFeature){var variableName,idPrefix,i;isComponentFeature?idPrefix=variableNames[0]+"_"+(variableName=variableNames[1]):idPrefix=variableName=variableNames[0];var templateVariable,countName=idPrefix+"count",variableCount=parseInt($('[name="'+countName+'"]').val());for(i in templateVars)if(templateVars[i].name==variableName){templateVariable=templateVars[i];break}if(1!=variableCount){var lastIndex=variableCount-1;for(i in $("#id_"+idPrefix+" br").last().remove(),templateVariable.values){var fieldVariable=templateVariable.values[i],lastElementDiv="fitem_id_"+idPrefix+"_"+lastIndex+"_"+fieldVariable.name;if($("#"+lastElementDiv).remove(),"numeric-array"===fieldVariable.type){var nestedCountName=idPrefix+"_"+lastIndex+"_"+fieldVariable.name+"count",nestedCount=parseInt($("[name='"+nestedCountName+"']").val());for(var j in nestedCount>=2&&$("#id_"+idPrefix+" br").slice(-(nestedCount-1)).remove(),fieldVariable.values)for(var nestedVariable=fieldVariable.values[j],k=0;k<nestedCount;k++){var nestedDiv=lastElementDiv+"_"+k+"_"+nestedVariable.name;$("#"+nestedDiv).remove()}var buttonDivId="fitem_id_addmore_"+idPrefix+"_"+lastIndex+"_"+fieldVariable.name;$("#"+buttonDivId).remove(),$("[name='"+nestedCountName+"']").remove()}}$('[name="'+countName+'"]').val(variableCount-1)}else{var elementIdPrefix="id_"+idPrefix+"_0";addElements.removeInputFromNode(templateVariable,elementIdPrefix)}},addMoreRootElements:function(templateVars,variableNames,isComponentFeature){var variableName,namePrefix,idPrefix,i;if(isComponentFeature){var componentFeatures=variableNames[0];namePrefix=componentFeatures+"["+(variableName=variableNames[1])+"]",idPrefix=componentFeatures+"_"+variableName}else namePrefix=variableName=variableNames[0],idPrefix=variableName;var templateVariable,countName=idPrefix+"count",variableCount=parseInt($('[name="'+countName+'"]').val());for(i in templateVars)if(templateVars[i].name==variableName){templateVariable=templateVars[i];break}var elementIdPrefix,prevIndex=variableCount-1,newElements="<br/>";for(i in templateVariable.values){var fieldVariable=templateVariable.values[i],newElementName=namePrefix+"["+variableCount+"]["+fieldVariable.name+"]",newElementId="id_"+idPrefix+"_"+variableCount+"_"+fieldVariable.name,prevElementName=namePrefix+"["+prevIndex+"]["+fieldVariable.name+"]",prevElementId="id_"+idPrefix+"_"+prevIndex+"_"+fieldVariable.name;if("numeric-array"==fieldVariable.type){var prevElementClasses=$("#fitem_"+prevElementId).attr("class");for(var j in newElements+='<div id="fitem_'+newElementId+'" class="'+prevElementClasses+'">',newElements+=$("#fitem_"+prevElementId).html(),newElements+="</div>",fieldVariable.values){var nestedVariable=fieldVariable.values[j],newNestedElementName=newElementName+"[0]["+nestedVariable.name+"]",newNestedElementId=newElementId+"_0_"+nestedVariable.name,prevNestedElementName=prevElementName+"[0]["+nestedVariable.name+"]",prevNestedElementId=prevElementId+"_0_"+nestedVariable.name,prevNestedIndex=prevIndex+".0",newNestedIndex=variableCount+".0";newElements+=addElements.copyElement(prevNestedElementName,prevNestedElementId,newNestedElementName,newNestedElementId,prevNestedIndex,newNestedIndex)}var newButtonId="id_addmore_"+idPrefix+"_"+variableCount+"_"+fieldVariable.name,newButtonName="addmore_"+namePrefix+"["+variableCount+"]["+fieldVariable.name+"]",prevButtonId="id_addmore_"+idPrefix+"_"+prevIndex+"_"+fieldVariable.name,prevButtonName="addmore_"+namePrefix+"["+prevIndex+"]["+fieldVariable.name+"]";newElements+=addElements.copyElement(prevButtonName,prevButtonId,newButtonName,newButtonId,null,null);var prevCountName=idPrefix+"_"+prevIndex+"_"+fieldVariable.name+"count",newCountHtml='<input name="'+(idPrefix+"_"+variableCount+"_"+fieldVariable.name+"count")+'" value="1" type="hidden"></input>';$('[name="'+prevCountName+'"]').after(newCountHtml)}else newElements+=addElements.copyElement(prevElementName,prevElementId,newElementName,newElementId,prevIndex,variableCount)}$("#fgroup_id_buttons_"+idPrefix).before(newElements),elementIdPrefix="id_"+idPrefix+"_"+variableCount,addElements.removeInputFromNode(templateVariable,elementIdPrefix),$('[name="'+countName+'"]').val(variableCount+1)},addMoreNestedElements:function(templateVars,variableNames,isComponentFeature,isPartOfAssocArray){var namePrefix,idPrefix,parentVariableName,variableName,topIndex,i;isPartOfAssocArray?(isComponentFeature?(namePrefix=variableNames[0]+"["+variableNames[1]+"]["+variableNames[2]+"]",idPrefix=variableNames[0]+"_"+variableNames[1]+"_"+variableNames[2],parentVariableName=variableNames[1],variableName=variableNames[2]):(namePrefix=variableNames[0]+"["+variableNames[1]+"]",idPrefix=variableNames[0]+"_"+variableNames[1],parentVariableName=variableNames[0],variableName=variableNames[1]),topIndex=null):isComponentFeature?(namePrefix=(namePrefix=variableNames[0]+"["+variableNames[1]+"]["+variableNames[2]+"]")+"["+variableNames[3]+"]",idPrefix=variableNames[0]+"_"+variableNames[1]+"_"+variableNames[2]+"_"+variableNames[3],parentVariableName=variableNames[1],variableName=variableNames[3],topIndex=variableNames[2]):(namePrefix=variableNames[0]+"["+variableNames[1]+"]["+variableNames[2]+"]",idPrefix=variableNames[0]+"_"+variableNames[1]+"_"+variableNames[2],parentVariableName=variableNames[0],variableName=variableNames[2],topIndex=variableNames[1]);var templateVariable,countName=idPrefix+"count",variableCount=parseInt($('[name="'+countName+'"]').val());for(i in templateVars)if(templateVars[i].name==parentVariableName)for(var j in templateVars[i].values)if(templateVars[i].values[j].name==variableName){templateVariable=templateVars[i].values[j];break}var prevIndex=variableCount-1,newElements="<br/>";for(i in templateVariable.values){var prevIndexPrefix,newIndexPrefix,fieldVariable=templateVariable.values[i],newElementName=namePrefix+"["+variableCount+"]["+fieldVariable.name+"]",newElementId="id_"+idPrefix+"_"+variableCount+"_"+fieldVariable.name,prevElementName=namePrefix+"["+prevIndex+"]["+fieldVariable.name+"]",prevElementId="id_"+idPrefix+"_"+prevIndex+"_"+fieldVariable.name;null===topIndex?(prevIndexPrefix=prevIndex,newIndexPrefix=variableCount):(prevIndexPrefix=topIndex+"."+prevIndex,newIndexPrefix=topIndex+"."+variableCount),newElements+=addElements.copyElement(prevElementName,prevElementId,newElementName,newElementId,prevIndexPrefix,newIndexPrefix)}$("#fitem_id_addmore_"+idPrefix).before(newElements);var elementIdPrefix="id_"+idPrefix+"_"+variableCount;addElements.removeInputFromNode(templateVariable,elementIdPrefix),$('[name="'+countName+'"]').val(variableCount+1)},removeInputFromNode:function(templateVariable,elementIdPrefix){var i;for(i in templateVariable.values){var fieldVariable=templateVariable.values[i],newElementId=elementIdPrefix+"_"+fieldVariable.name;if("text"!=fieldVariable.type&&"int"!=fieldVariable.type||$("#"+newElementId).val(""),"multiple-options"==fieldVariable.type||"boolean"==fieldVariable.type)"required"in fieldVariable&&!0===fieldVariable.required||$("#"+newElementId+' option[value="undefined"]').prop("selected",!0).change();if("numeric-array"==fieldVariable.type)for(var countName=newElementId.replace("id_","")+"count",variableCount=parseInt($('[name="'+countName+'"]').val()),j=0;j<variableCount;j++){var newIdPrefix=newElementId+"_"+j;addElements.removeInputFromNode(fieldVariable,newIdPrefix)}}},copyElement:function(prevElementName,prevElementId,newElementName,newElementId,prevIndex,newIndex){for(var prevElementClasses=$("#fitem_"+prevElementId).attr("class"),newElementHtml=$("#fitem_"+prevElementId).html();-1!=newElementHtml.indexOf(prevElementId);)newElementHtml=newElementHtml.replace(prevElementId,newElementId);for(;-1!=newElementHtml.indexOf(prevElementName);)newElementHtml=newElementHtml.replace(prevElementName,newElementName);null!==prevIndex&&(prevIndex+=". ",newIndex+=". ",newElementHtml=newElementHtml.replace('label for="'+newElementId+'">'+prevIndex,'label for="'+newElementId+'">'+newIndex));var newElement='<div id="fitem_'+newElementId+'" class="'+prevElementClasses+'">';return newElement+=newElementHtml,newElement+="</div>"},addMore:function(){$(document).ready((function(){$(".mform").on("click",":button",(function(event){var buttonName=event.target.name;if(-1!==buttonName.indexOf("addmore_")||-1!==buttonName.indexOf("delete_")){var shouldAdd,variableName,templateVars=$.parseJSON($('[name="templatevars"]').val()),componentFeatures=$('[name="componenttype1"]').val()+"_features";-1!==buttonName.indexOf("addmore_")?(shouldAdd=!0,variableName=buttonName.replace("addmore_","")):(variableName=buttonName.replace("delete_",""),shouldAdd=!1);var isComponentFeature,variableNames=variableName.split(/\]\[|\[|\]/gi);0===variableNames[variableNames.length-1].length&&variableNames.pop(),isComponentFeature=variableNames[0]===componentFeatures;var isNested=!1;for(var i in variableNames)if($.isNumeric(variableNames[i])){isNested=!0;break}var isPartOfAssocArray=!1;isNested||(isComponentFeature&&3===variableNames.length&&(isNested=!0,isPartOfAssocArray=!0),isComponentFeature||2!==variableNames.length||(isNested=!0,isPartOfAssocArray=!0)),shouldAdd?isNested?addElements.addMoreNestedElements(templateVars,variableNames,isComponentFeature,isPartOfAssocArray):addElements.addMoreRootElements(templateVars,variableNames,isComponentFeature):addElements.deleteElements(templateVars,variableNames,isComponentFeature)}}))}))}};return addElements}));

//# sourceMappingURL=addmore.min.js.map